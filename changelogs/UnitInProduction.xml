<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
         
         <changeSet id="AddUnitInProductionfromTimberUnit" author="Caio">
         <addColumn
         tableName="Production">
         <column name="Unit"
         type="INT">
         <constraints foreignKeyName="FK_Production_Unit_TimberUnit_OID" references="TimberUnit(OID)" deleteCascade="true"/>
         </column>
         </addColumn>
         <sql>
         UPDATE Production
         SET Unit = UnitSynonym.Unit
         UnitSynonym JOIN Production ON MeasurementUnit = UnitSynonym.Description COLLATE SQL_Latin1_General_Cp1_CI_AI
         </sql>
         <dropColumn tableName="Production" columnName="MeasurementUnit"/>
         </changeSet>
         <rollback>
         <addColumn
         tableName="Production">
         <column name="MeasurementUnit"
         type="VARCHAR(30)">
         </column>
         </addColumn>
         <sql>UPDATE Production SET MeasurementUnit = TimberUnit.Description
         FROM TimberUnit JOIN Production ON TimberUnit.OID = Production.Unit</sql>
         <dropForeignKeyConstraint baseTableName="Production" constraintName="FK_Production_Unit_TimberUnit_OID"/>
         <dropColumn tableName="Production" columnName="Unit"/>
         </rollback>
</databaseChangeLog>